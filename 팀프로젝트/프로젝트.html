<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>리뷰</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
    />
    <script
      src="https://code.jquery.com/jquery-3.6.1.min.js"
      integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css"
    />
    <style>
      /* 폼 전체 */
      .wrap {
        width: 100%;
        margin-top: 16px;
        background-color: rgb(255, 255, 255);
        height: 100%;
        padding: 20px 30px 50px;
        box-sizing: border-box;
        display: flex;
        align-items: center;
      }

      .outer {
        width: 100%;
        min-width: 500px;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .comment {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 0 16px 0;
        width: 100%;
      }

      .input {
        display: flex;
        width: 100%;
      }

      .nn {
        display: flex;
        flex-direction: column;
        flex: 0 0 auto;
        height: 160px;
        width: 20%;
      }

      .icon {
        margin-top: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 130px;
        font-size: 60px;
        padding-bottom: 30px;
        border-radius: 50%;
      }

      .ni {
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: end;
        height: 15px;
      }

      .rerabu {
        border-style: solid;
        border-color: black;
        position: relative;
        width: 80%;
        flex-direction: column;
      }

      .re {
        flex: 1 1 auto;
        padding: 16px 16px 0 16px;
        min-width: 0;
        min-height: 66px;
        display: flex;
        flex: 1 1 auto;
        flex-direction: column;
      }

      .rabu {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
      }

      /* 별점 관련 */
      /* .rating {
        text-align: center;
      } */

      .rating .rate_radio + label {
        position: relative;
        display: inline-block;
        margin-left: -4px;
        z-index: 10;
        width: 30px;
        height: 30px;
        background-image: url("./image/starrate.png");
        background-repeat: no-repeat;
        background-size: 30px 30px;
        cursor: pointer;
        background-color: #f0f0f0;
      }
      .rating .rate_radio:checked + label {
        background-color: rgb(235, 235, 20);
      }

      /* 체크박스 안보이게 */
      [type="checkbox"] {
        display: none;
      }

      /* 리뷰전체 칸 */
      .list {
        display: flex;
        flex-direction: column;
        /* background-color: rgb(238, 255, 170); */
        width: 100%;
        /* height: 1000px; */
        margin-bottom: 50px;
      }

      /* 개인 리뷰칸 */
      .reviews {
        display: flex;
        flex-direction: row;
        width: 100%;
        /* height: 10%; */
        /* padding-top: 10px; */
        border-style: solid;
        border-color: black;
        margin-bottom: 5px;
      }

      /* 닉네임칸 */
      .left {
        display: flex;
        flex-direction: column;
        flex: 0 0 auto;
        /* height: 10%; */
        width: 30%;
        align-items: center;
        border-style: solid;
        border-right: medium solid rgb(0, 0, 0);
        border-bottom: 0;
        border-top: 0;
        border-left: 0;
        /* justify-content: center; */
      }
      /* div 위치 확인용 완성후 nickname부터 icon2까지 배경색지우기 */
      .nickname {
        /* background-color: bisque; */
        font-weight: bold;
      }
      .textreview {
        /* background-color: brown; */
        font-size: 1.5rem;
        padding-left: 10px;
      }

      .stars {
        /* background-color: darkgrey; */
        width: 100%;
        padding-left: 10px;
      }
      .dates {
        /* background-color: darkseagreen; */
        padding-left: 10px;
      }

      .icon2 {
        font-size: 30px;
        /* padding-top: 15px; */

        /* background-color: cornflowerblue; */
      }

      /* 리뷰,별점,작성일 칸 */
      .right {
        width: 70%;
        /* height: 10vw; */
        display: flex;
        flex-direction: column;
        justify-content: space-evenly;
      }

      .side {
        font-size: 0.8rem;
      }

      img {
        max-width: 100%;
        height: auto;
      }

      @media (max-width: 990px) {
        .wrap {
          flex-direction: column;
        }
        .comment {
          flex-direction: column;
        }
        .input {
          flex-direction: column;
        }
        .icon {
          flex-direction: column;
        }
        .ni {
          flex-direction: column;
          padding-bottom: 30px;
          align-items: center;
        }
        .rabu {
          flex-direction: column;
        }
        .reviews {
          flex-direction: column;
        }
        .nn {
          justify-content: center;
          align-items: center;
          width: 100%;
        }
        .icon1 {
          padding-bottom: 0px;
        }
        .rerabu {
          width: 100%;
        }

        .rating {
          text-align: center;
        }

        .left {
          flex-direction: row;
          /* height: 6vw; */
          border-right: 0;
        }

        .right {
          width: 100%;
          border-right: 0;
          border-bottom: 0;
          border-top: medium solid rgb(0, 0, 0);
          border-left: 0;
        }

        .stars {
          width: 30%;
          padding-left: 30px;
        }

        .textreview {
          padding-left: 30px;
        }

        .dates {
          padding-left: 50px;
        }

        .side {
          display: flex;
          flex-direction: row;
        }
      }

      @import url("https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap");

      .navbar {
        padding-top: 1vh;
        padding-bottom: 1vh;
        font-size: 14px;
        background-color: #f4f4f4;
      }

      .nav-item {
        margin-left: 3rem;
        margin-right: 3rem;
      }

      .navbar-brand {
        font-size: 20px;
        font-weight: bold;
      }

      .hidden {
        display: none;
      }

      .welcDiv {
        font-family: "Gamja Flower", cursive;
        margin-right: 5rem;
        font-size: 2rem;
      }

      @media (max-width: 1150px) {
        .nav-item {
          margin-right: 1.5rem;
          margin-left: 1.5rem;
        }
      }

      @media (max-width: 990px) {
        .nicknameBox {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">LOGO</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                랜드마크
              </a>

              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">랜드마크1</a></li>
                <li><a class="dropdown-item" href="#">랜드마크2</a></li>
                <li><a class="dropdown-item" href="#">랜드마크3</a></li>
              </ul>
            </li>

            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                음식
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">음식1</a></li>
                <li><a class="dropdown-item" href="#">음식2</a></li>
                <li><a class="dropdown-item" href="#">음식3</a></li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">리뷰</a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="#">공지사항</a>
            </li>
          </ul>

          <div class="nicknameBox">
            <div class="nickDiv">
              <form class="d-flex nickForm" role="nickName">
                <input
                  class="form-control me-2 nickInput"
                  type="nickName"
                  placeholder="닉네임을 적어주세요!"
                  aria-label="nickName"
                />
                <button class="btn btn-outline-success" type="submit">
                  Login
                </button>
              </form>
            </div>
            <div class="welcDiv hidden"></div>
          </div>
        </div>
      </div>
    </nav>
    <!-- 리뷰폼 시작 -->
    <form class="wrap" name="review">
      <div class="outer">
        <div class="comment">
          <h2>리뷰를 작성해주세요!</h2>
        </div>
        <hr />
        <div class="input">
          <div class="nn">
            <i class="bi bi-person-circle icon"></i>

            <div class="ni">
              <!-- 닉네임 -->
              <input
                type="text"
                placeholder="nickname"
                onfocus="this.placeholder = ''"
                onblur="this.placeholder = 'nickname'"
                id="nickname"
              />
            </div>
          </div>
          <div class="rerabu">
            <div class="re">
              <!-- 리뷰작성 -->
              <textarea
                id="review"
                cols="80"
                rows="3"
                placeholder="write a review"
                onfocus="this.placeholder = ''"
                onblur="this.placeholder = 'write a review'"
              ></textarea>
            </div>
            <div class="rabu">
              <!-- 별점 -->
              <div class="rating">
                <div class="ratefill"></div>
                <!-- 해당 별점을 클릭하면 해당 별과 그 왼쪽의 모든 별의 체크박스에 checked 적용 -->
                <input
                  type="checkbox"
                  name="rating"
                  id="rating1"
                  value="1"
                  class="rate_radio"
                  title="1점"
                />
                <label for="rating1"></label>
                <input
                  type="checkbox"
                  name="rating"
                  id="rating2"
                  value="2"
                  class="rate_radio"
                  title="2점"
                />
                <label for="rating2"></label>
                <input
                  type="checkbox"
                  name="rating"
                  id="rating3"
                  value="3"
                  class="rate_radio"
                  title="3점"
                />
                <label for="rating3"></label>
                <input
                  type="checkbox"
                  name="rating"
                  id="rating4"
                  value="4"
                  class="rate_radio"
                  title="4점"
                />
                <label for="rating4"></label>
                <input
                  type="checkbox"
                  name="rating"
                  id="rating5"
                  value="5"
                  class="rate_radio"
                  title="5점"
                />
                <label for="rating5"></label>
              </div>

              <!-- 등록버튼 -->
              <div class="bu">
                <button type="submit" class="btn btn-primary">등록</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
    <hr />
    <!-- 리뷰 출력되는 부분 -->
    <div class="list">
      <!-- <div class="reviews">
        <div class="left">
          <div class="icon2"></div>
          <div class="nickname"></div>
        </div>
        <div class="right">
          <div class="textreview"></div>
          <div class='side'></div>
            <div class="stars"></div>
            <div class="dates"></div>
        </div>
      </div> -->
    </div>
    <script>
      // 리뷰 등록버튼 누르면 실행되는 함수
      const form = document.querySelector(".wrap");
      form.addEventListener("submit", function (event) {
        event.preventDefault();
        const nickname = document.getElementById("nickname").value;
        const review = document.getElementById("review").value;

        const list = document.querySelector(".list");
        const reviews = document.querySelector(".reviews");
        const left = document.querySelector(".left");
        const right = document.querySelector(".right");
        const side = document.querySelector(".side");

        const date = new Date();
        const year = date.getFullYear();
        const month = date.getMonth();
        const day = date.getDate();

        const rating1 = document.getElementById("rating1");
        const rating2 = document.getElementById("rating2");
        const rating3 = document.getElementById("rating3");
        const rating4 = document.getElementById("rating4");
        const rating5 = document.getElementById("rating5");

        const divReviews = document.createElement("div");
        divReviews.classList.add("reviews"); // div.reviews 생성
        const divLeft = document.createElement("div");
        divLeft.classList.add("left"); // div.left 생성
        const divRight = document.createElement("div");
        divRight.classList.add("right"); // div.right 생성
        const divSide = document.createElement("div");
        divSide.classList.add("side"); // div.side 생성

        const pericon = document.createElement("div");
        pericon.innerHTML = '<i class="bi bi-person-circle"></i>';
        pericon.classList.add("icon2");
        const pernick = document.createElement("div");
        pernick.textContent = nickname;
        pernick.classList.add("nickname"); // div.nickname 생성 후 nickname value값 삽입

        const pertxt = document.createElement("div");
        pertxt.textContent = review;
        pertxt.classList.add("textreview"); // div.txtreview 생성 후 txtreview value값 삽입

        const perstar = document.createElement("div");

        const star1 = rating1.checked;
        const star2 = rating2.checked;
        const star3 = rating3.checked;
        const star4 = rating4.checked;
        const star5 = rating5.checked;

        if (star5 == true) {
          perstar.innerHTML = '<img src="./image/5점.png" alt ="별점이미지">';
          console.log("5");
        } else if (star4 == true && star5 != true) {
          perstar.innerHTML = '<img src="./image/4점.png" alt ="별점이미지">';
          console.log("4");
        } else if (star3 == true && star4 != true) {
          perstar.innerHTML = '<img src="./image/3점.png" alt ="별점이미지">';
          console.log("3");
        } else if (star2 == true && star3 != true) {
          perstar.innerHTML = '<img src="./image/2점.png" alt ="별점이미지">';
          console.log("2");
        } else if (star1 == true && star2 != true) {
          perstar.innerHTML = '<img src="./image/1점.png" alt ="별점이미지">';
          console.log("1");
        } else {
          perstar.textContent = "";
          console.log("0");
        }
        perstar.classList.add("stars"); // div.stars 생성 후 stars value값 삽입

        const perdate = document.createElement("div");
        perdate.textContent = `${year}.${month + 1}.${day}`;
        perdate.classList.add("dates"); // div.dates 생성 후 dates value값 삽입

        list.append(divReviews);
        if (nickname === "" || review === "") {
          perdate.textContent = "";
          pericon.innerHTML = "";
        } // nickname value와 review value가 없을때 date출력되지 않게끔
        divReviews.append(divLeft, divRight);

        divLeft.append(pericon, pernick);
        divRight.append(pertxt, divSide);
        divSide.append(perstar, perdate);

        // document.getElementById("nickname").value = "";
        // document.getElementById("review").value = "";
        $("form[name='review']").each(function () {
          this.reset();
        }); // 등록 눌렀을때 폼 초기화
      });

      function Rating() {}
      Rating.prototype.rate = 0;
      Rating.prototype.setRate = function (rateobj, newrate) {
        //별점 마킹 - 클릭한 별 이하 모든 별 체크 처리
        this.rate = newrate;
        let checks = null;
        //요소가 파라메터로 넘어오면 별점 클릭, 없으면 저장 후 전체 초기화
        if (rateobj) {
          rateobj.querySelector(".ratefill").style.width =
            parseInt(newrate * 60) + "px"; // 현재 별점 갯수 채색
          checks = rateobj.querySelectorAll(".rate_radio"); // 넘어온 요소 하위의 라디오버튼만 선택
        } else {
          //전체 별점 채색 초기화
          const rateFills = document.querySelectorAll(".ratefill");
          rateFills.forEach(function (item) {
            item.style.width = parseInt(newrate * 60) + "px"; //
          });
        }

        //별점 체크 라디오 버튼 처리
        if (checks) {
          checks.forEach(function (item, idx) {
            if (idx < newrate) {
              item.checked = true;
            } else {
              item.checked = false;
            }
          });
        }
      };
      let rating = new Rating(); //별점 인스턴스 생성
      document.addEventListener("DOMContentLoaded", function () {
        //별점선택 이벤트 리스너
        const rateForms =
          document.querySelectorAll(
            ".rating"
          ); /* 별점 선택 템플릿을 모두 선택 */
        rateForms.forEach(function (item) {
          //클릭 이벤트 리스너 각각 등록
          item.addEventListener("click", function (e) {
            let elem = e.target;
            if (elem.classList.contains("rate_radio")) {
              rating.setRate(elem.parentElement, parseInt(elem.value)); // setRate() 에 ".rating" 요소를 첫 번째 파라메터로 넘김
            }
          });
        });
      });

      $(".nickForm").submit(function (e) {
        e.preventDefault();
        let nickVal = $(".nickInput").val();

        $(".nickInput").val("");

        $(".nickDiv").addClass("hidden");

        $(".welcDiv").removeClass("hidden");

        $(".welcDiv").text(`환영합니다 ${nickVal}님`);
        console.log(nickVal);
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
