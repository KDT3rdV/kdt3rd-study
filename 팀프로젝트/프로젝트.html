<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>리뷰</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
    />
    <style>
      .wrap {
        max-width: 480px;
        margin: 0 auto;
        background-color: #fff;
        height: 100%;
        padding: 20px;
        box-sizing: border-box;
      }
      .rating .rate_radio + label {
        position: relative;
        display: inline-block;
        margin-left: -4px;
        z-index: 10;
        width: 30px;
        height: 30px;
        background-image: url("./image/starrate.png");
        background-repeat: no-repeat;
        background-size: 30px 30px;
        cursor: pointer;
        background-color: #f0f0f0;
      }
      .rating .rate_radio:checked + label {
        background-color: rgb(235, 235, 20);
      }

      [type="checkbox"] {
        display: none;
      }

      .list {
        display: flex;
        flex-direction: column;
        background-color: rgb(187, 122, 122);
        width: 100%;
        height: 300px;
      }

      .reviews {
        display: flex;
        flex-direction: row;
        background-color: limegreen;
        width: 100%;
        height: 90px;
      }

      .left {
        width: 70%;
        height: 90px;
        background-color: coral;
      }

      .right {
        width: 30%;
        height: 90px;
        display: flex;
        flex-direction: column;
        background-color: fuchsia;
      }
    </style>
  </head>
  <body>
    <h2>리뷰</h2>
    <hr />
    <form class="wrap">
      <div>
        <input type="text" placeholder="닉네임" id="nickname" />

        <div class="review_rating">
          <div class="warning_msg"></div>
          <div class="rating">
            <div class="ratefill"></div>
            <!-- 해당 별점을 클릭하면 해당 별과 그 왼쪽의 모든 별의 체크박스에 checked 적용 -->
            <input
              type="checkbox"
              name="rating"
              id="rating1"
              value="1"
              class="rate_radio"
              title="1점"
            />
            <label for="rating1"></label>
            <input
              type="checkbox"
              name="rating"
              id="rating2"
              value="2"
              class="rate_radio"
              title="2점"
            />
            <label for="rating2"></label>
            <input
              type="checkbox"
              name="rating"
              id="rating3"
              value="3"
              class="rate_radio"
              title="3점"
            />
            <label for="rating3"></label>
            <input
              type="checkbox"
              name="rating"
              id="rating4"
              value="4"
              class="rate_radio"
              title="4점"
            />
            <label for="rating4"></label>
            <input
              type="checkbox"
              name="rating"
              id="rating5"
              value="5"
              class="rate_radio"
              title="5점"
            />
            <label for="rating5"></label>
          </div>
        </div>
      </div>
      <br />
      <div>
        <textarea id="review" rows="10"></textarea>
      </div>

      <button type="submit">등록</button>
    </form>
    <div class="list">
      <!-- <div class="reviews">
        <div class="left">
          <div class="nickname"></div>
        </div>
        <div class="right">
          <div class="textreview"></div>
          <div class="stars"></div>
          <div class="dates"></div>
        </div>
      </div> -->
    </div>
    <script>
      const form = document.querySelector("form");
      form.addEventListener("submit", function (event) {
        event.preventDefault();
        const nickname = document.getElementById("nickname").value;
        const review = document.getElementById("review").value;
        // const rating = document.querySelector(".rating").value;  // 추가할지 삭제할지 div작업 끝내고 판단

        const list = document.querySelector(".list");
        const reviews = document.querySelector(".reviews");
        const left = document.querySelector("left");
        const right = document.querySelector("right");

        const date = new Date();
        const year = date.getFullYear();
        const month = date.getMonth();
        const day = date.getDate();

        const rating1 = document.getElementById("rating1");
        const rating2 = document.getElementById("rating2");
        const rating3 = document.getElementById("rating3");
        const rating4 = document.getElementById("rating4");
        const rating5 = document.getElementById("rating5");

        const divReviews = document.createElement("div");
        divReviews.classList.add("reviews");
        const divLeft = document.createElement("div");
        divLeft.classList.add("left");
        const divRight = document.createElement("div");
        divLeft.classList.add("right");

        const pernick = document.createElement("div");
        pernick.textContent = nickname;
        pernick.classList.add("nickname");

        const pertxt = document.createElement("div");
        pertxt.textContent = review;
        pertxt.classList.add("textreview");

        const perstar = document.createElement("div");
        function checked() {
          const star1 = rating1.checked;
          const star2 = rating2.checked;
          const star3 = rating3.checked;
          const star4 = rating4.checked;
          const star5 = rating5.checked;
          if (star5 == true) {
            perstar.textContent = 5;
            console.log("5");
          } else if (star4 == true && star5 != true) {
            perstar.textContent = 4;
            console.log("4");
          } else if (star3 == true && star4 != true) {
            perstar.textContent = 3;
            console.log("3");
          } else if (star2 == true && star3 != true) {
            perstar.textContent = 2;
            console.log("2");
          } else if (star1 == true && star2 != true) {
            perstar.textContent = 1;
            console.log("1");
          } else {
            perstar.textContent = "";
            console.log("0");
          }
        }
        perstar.classList.add("stars");

        const perdate = document.createElement("div");
        perdate.textContent = `${year}.${month + 1}.${day}`;
        perdate.classList.add("dates");

        list.append(divReviews);
        if (nickname === "" || review === "") {
          perdate.textContent = "";
        }
        divReviews.append(divLeft, divRight);

        divLeft.append(pernick);
        divRight.append(pertxt, perstar, perdate);

        document.getElementById("nickname").value = "";
        document.getElementById("review").value = "";
      });

      function Rating() {}
      Rating.prototype.rate = 0;
      Rating.prototype.setRate = function (rateobj, newrate) {
        //별점 마킹 - 클릭한 별 이하 모든 별 체크 처리
        this.rate = newrate;
        let checks = null;
        //요소가 파라메터로 넘어오면 별점 클릭, 없으면 저장 후 전체 초기화
        if (rateobj) {
          rateobj.querySelector(".ratefill").style.width =
            parseInt(newrate * 60) + "px"; // 현재 별점 갯수 채색
          checks = rateobj.querySelectorAll(".rate_radio"); // 넘어온 요소 하위의 라디오버튼만 선택
        } else {
          //전체 별점 채색 초기화
          const rateFills = document.querySelectorAll(".ratefill");
          rateFills.forEach(function (item) {
            item.style.width = parseInt(newrate * 60) + "px";
          });
          //전체 라디오 버튼 초기화
          checks = document.querySelectorAll(".rate_radio");
        }
        //별점 체크 라디오 버튼 처리
        if (checks) {
          checks.forEach(function (item, idx) {
            if (idx < newrate) {
              item.checked = true;
            } else {
              item.checked = false;
            }
          });
        }
      };
      let rating = new Rating(); //별점 인스턴스 생성
      document.addEventListener("DOMContentLoaded", function () {
        //별점선택 이벤트 리스너
        const rateForms =
          document.querySelectorAll(
            ".rating"
          ); /* 별점 선택 템플릿을 모두 선택 */
        rateForms.forEach(function (item) {
          //클릭 이벤트 리스너 각각 등록
          item.addEventListener("click", function (e) {
            let elem = e.target;
            if (elem.classList.contains("rate_radio")) {
              rating.setRate(elem.parentElement, parseInt(elem.value)); // setRate() 에 ".rating" 요소를 첫 번째 파라메터로 넘김
            }
          });
        });
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
